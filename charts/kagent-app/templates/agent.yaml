apiVersion: kagent.dev/v1alpha2
kind: Agent
metadata:
  name: {{ .Values.agent.name }}
  namespace: {{ .Values.agent.namespace | default .Values.global.namespace }}
  labels:
    {{- include "k2a-agent.labels" . | nindent 4 }}
spec:
  declarative:
    modelConfig: {{ .Values.agent.modelConfig }}
    {{- if .Values.agent.systemMessageConfigMap }}
    {{- if .Values.agent.systemMessageConfigMap.enabled }}
    systemMessageFrom:
      type: ConfigMap
      name: {{ .Values.agent.systemMessageConfigMap.name | default "k2a-system-prompt" }}
      key: {{ .Values.agent.systemMessageConfigMap.key | default "system-prompt" }}
    {{- else }}
    systemMessage: |
      {{- .Values.agent.systemMessage | nindent 6 }}
    {{- end }}
    {{- else }}
    systemMessage: |
      {{- .Values.agent.systemMessage | nindent 6 }}
    {{- end }}
    tools:
    {{- range $key, $server := .Values.mcpServers }}
    {{- if $server.enabled }}
    - type: McpServer
      mcpServer:
        apiGroup: kagent.dev
        kind: RemoteMCPServer
        name: {{ $server.name }}
        toolNames:
        {{- range $server.tools }}
        - {{ . }}
        {{- end }}
    {{- end }}
    {{- end }}
    {{- if .Values.a2aSkills }}
    a2aConfig:
      skills:
      {{- range .Values.a2aSkills }}
      - id: {{ .id }}
        name: {{ .name }}
        description: {{ .description | quote }}
        {{- if .examples }}
        examples:
        {{- range .examples }}
        - {{ . | quote }}
        {{- end }}
        {{- end }}
        {{- if .tags }}
        tags:
        {{- range .tags }}
        - {{ . }}
        {{- end }}
        {{- end }}
        {{- if .inputModes }}
        inputModes:
        {{- range .inputModes }}
        - {{ . }}
        {{- end }}
        {{- end }}
        {{- if .outputModes }}
        outputModes:
        {{- range .outputModes }}
        - {{ . }}
        {{- end }}
        {{- end }}
      {{- end }}
    {{- end }}
    deployment:
      resources:
        {{- toYaml .Values.agent.resources | nindent 8 }}
