# Default values for mcp-servers chart

global:
  imageRegistry: image-registry.openshift-image-registry.svc:5000
  namespace: k2a-mcp-servers

# Common settings
common:
  labels:
    app.kubernetes.io/part-of: k2a-enterprise-monitoring
  securityContext:
    runAsNonRoot: true
    seccompProfile:
      type: RuntimeDefault
  containerSecurityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop: ["ALL"]
    runAsNonRoot: true

# RBAC
rbac:
  create: true
  serviceAccountName: k2a-monitoring
  clusterRoleBinding:
    name: k2a-monitoring-view
    clusterRole: cluster-monitoring-view

# MCP Servers configuration
servers:
  prometheus:
    enabled: true
    name: prometheus-mcp
    replicas: 1
    image:
      repository: k2a-mcp-servers/prometheus-mcp
      tag: latest
      pullPolicy: Always
    port: 8000
    command: ["python", "-m", "prometheus_mcp"]
    args: ["--transport", "streamable-http", "--port", "8000"]
    config:
      PROMETHEUS_URL: "https://thanos-querier.openshift-monitoring.svc.cluster.local:9091"
      PROMETHEUS_VERIFY_SSL: "false"
      LOG_LEVEL: "info"
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi
    probes:
      liveness:
        path: /mcp
        initialDelaySeconds: 30
        periodSeconds: 60
      readiness:
        path: /mcp
        initialDelaySeconds: 10
        periodSeconds: 30
    # BuildConfig for OpenShift (disabled - images already built)
    build:
      enabled: false
      gitUri: https://github.com/jeanlopezxyz/k2a-enterprise-monitoring.git
      gitRef: main
      contextDir: src/prometheus-mcp

  alertmanager:
    enabled: true
    name: alertmanager-mcp
    replicas: 1
    image:
      repository: k2a-mcp-servers/alertmanager-mcp
      tag: latest
      pullPolicy: Always
    port: 8000
    command: ["python", "-m", "alertmanager_mcp"]
    args: ["--transport", "streamable-http", "--port", "8000"]
    config:
      ALERTMANAGER_URL: "https://alertmanager-main.openshift-monitoring.svc.cluster.local:9094"
      ALERTMANAGER_VERIFY_SSL: "false"
      LOG_LEVEL: "info"
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi
    probes:
      liveness:
        path: /mcp
        initialDelaySeconds: 30
        periodSeconds: 60
      readiness:
        path: /mcp
        initialDelaySeconds: 10
        periodSeconds: 30
    build:
      enabled: false
      gitUri: https://github.com/jeanlopezxyz/k2a-enterprise-monitoring.git
      gitRef: main
      contextDir: src/alertmanager-mcp

  redhatCases:
    enabled: true
    name: redhat-cases-mcp
    replicas: 1
    image:
      repository: k2a-mcp-servers/redhat-cases-mcp
      tag: latest
      pullPolicy: Always
    port: 8000
    command: ["python", "-m", "redhat_cases_mcp"]
    args: ["--transport", "streamable-http", "--port", "8000"]
    config:
      LOG_LEVEL: "info"
    secrets:
      REDHAT_API_OFFLINE_TOKEN: ""  # Set via --set or external secret
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi
    probes:
      liveness:
        path: /mcp
        initialDelaySeconds: 30
        periodSeconds: 60
      readiness:
        path: /mcp
        initialDelaySeconds: 10
        periodSeconds: 30
    build:
      enabled: false
      gitUri: https://github.com/jeanlopezxyz/k2a-enterprise-monitoring.git
      gitRef: main
      contextDir: src/redhat-cases-mcp
