apiVersion: v1
kind: ConfigMap
metadata:
  name: k2a-agent-config
  namespace: k2a-monitoring
  labels:
    app: k2a-monitoring
    component: config
data:
  config.yaml: |
    # Configuración del K2A Agent
    server:
      port: 8080
      metrics_port: 8081
      health_port: 8082
      
    monitoring:
      interval: 30s
      timeout: 10s
      
    cluster:
      name: "${CLUSTER_NAME}"
      environment: "${ENVIRONMENT}"
      
    collection:
      # Métricas de nodos
      nodes:
        enabled: true
        metrics:
          - cpu_usage
          - memory_usage
          - disk_usage
          - network_io
          
      # Métricas de pods
      pods:
        enabled: true
        namespaces: []  # vacío = todos los namespaces
        metrics:
          - cpu_usage
          - memory_usage
          - restart_count
          - status
          
      # Métricas de servicios
      services:
        enabled: true
        metrics:
          - endpoint_count
          - health_status
          
    export:
      formats:
        - prometheus
        - json
        - csv
        
    alerting:
      enabled: true
      thresholds:
        node_cpu_high: 80
        node_memory_high: 85
        pod_restart_high: 5
        
    logging:
      level: info
      format: json
      
  alerts.yaml: |
    # Definición de alertas
    alerts:
      - name: NodeCPUHigh
        condition: "node_cpu_usage > 80"
        severity: warning
        message: "CPU usage high on node {{ .NodeName }}"
        
      - name: NodeMemoryHigh
        condition: "node_memory_usage > 85"
        severity: warning
        message: "Memory usage high on node {{ .NodeName }}"
        
      - name: PodRestartHigh
        condition: "pod_restart_count > 5"
        severity: critical
        message: "Pod {{ .PodName }} in {{ .Namespace }} has restarted {{ .RestartCount }} times"