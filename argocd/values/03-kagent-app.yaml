# =============================================================================
# K2A Production Values
# =============================================================================
#
# Este archivo contiene la configuracion de produccion para:
#   - MCP Servers (Quarkus Native: Prometheus, AlertManager, Red Hat Cases, Sessionize)
#   - K2A Agent (Agente de IA)
#
# PREREQUISITO: Crear los secrets antes de desplegar
#   kubectl create namespace kagent
#   kubectl create secret generic kagent-openai-secret \
#     --namespace kagent \
#     --from-literal=api-key="sk-..."
#
# =============================================================================

# =============================================================================
# SECCION 1: MCP SERVERS (chart: kmcp-servers) - Quarkus Native
# =============================================================================

# Namespace para MCP Servers
global:
  namespace: k2a-mcp-servers

servers:
  # ------------------------------------------
  # Prometheus MCP Server (Quarkus Native)
  # ------------------------------------------
  prometheus:
    enabled: true
    name: prometheus-mcp
    description: "MCP Server para consultas PromQL a Prometheus/Thanos (Quarkus Native)"
    transportType: http
    image:
      repository: ghcr.io/jeanlopezxyz/mcp-prometheus
      tag: "1.0.7"
    port: 9081
    env:
      PROMETHEUS_URL: "https://thanos-querier.openshift-monitoring.svc.cluster.local:9091"
      QUARKUS_HTTP_HOST: "0.0.0.0"
      QUARKUS_HTTP_PORT: "9081"
      # Trust OpenShift internal SSL certificates
      QUARKUS_TLS_TRUST_ALL: "true"
    httpTransport:
      targetPort: 9081
      path: /mcp
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 500m
        memory: 256Mi

  # ------------------------------------------
  # AlertManager MCP Server (Quarkus Native)
  # ------------------------------------------
  alertmanager:
    enabled: true
    name: alertmanager-mcp
    description: "MCP Server para AlertManager (Quarkus Native)"
    transportType: http
    image:
      repository: ghcr.io/jeanlopezxyz/mcp-alertmanager
      tag: "1.0.12"
    port: 9082
    env:
      ALERTMANAGER_URL: "https://alertmanager-main.openshift-monitoring.svc.cluster.local:9094"
      QUARKUS_HTTP_HOST: "0.0.0.0"
      QUARKUS_HTTP_PORT: "9082"
      # Trust OpenShift internal SSL certificates
      QUARKUS_TLS_TRUST_ALL: "true"
    httpTransport:
      targetPort: 9082
      path: /mcp
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 500m
        memory: 256Mi

  # ------------------------------------------
  # Red Hat Cases MCP Server (Quarkus Native)
  # ------------------------------------------
  redhatCases:
    enabled: true
    name: redhat-cases-mcp
    description: "MCP Server para Red Hat KB y casos de soporte (Quarkus Native)"
    transportType: http
    image:
      repository: ghcr.io/jeanlopezxyz/mcp-redhat-cases
      tag: "1.0.4"
    port: 9080
    env:
      QUARKUS_HTTP_HOST: "0.0.0.0"
      QUARKUS_HTTP_PORT: "9080"
    secretRefs:
      - redhat-cases-mcp-secrets
    httpTransport:
      targetPort: 9080
      path: /mcp
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 500m
        memory: 256Mi

  # ------------------------------------------
  # Sessionize MCP Server (Quarkus Native)
  # ------------------------------------------
  sessionize:
    enabled: true
    name: sessionize-mcp
    description: "MCP Server para Sessionize - conferencias y eventos (Quarkus Native)"
    transportType: http
    image:
      repository: ghcr.io/jeanlopezxyz/mcp-sessionize
      tag: "1.0.2"
    port: 8080
    env:
      QUARKUS_HTTP_HOST: "0.0.0.0"
      QUARKUS_HTTP_PORT: "8080"
      # SESSIONIZE_EVENT_ID: ""  # Configurar via secret o tool parameter
    httpTransport:
      targetPort: 8080
      path: /mcp
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 500m
        memory: 256Mi

# =============================================================================
# SECCION 2: K2A AGENT (chart: kagent-app)
# =============================================================================

# ModelConfig - Configuracion del modelo LLM
# gpt-4o-mini: 15x más económico que gpt-4o, rápido, 128K contexto
modelConfig:
  create: true
  name: k2a-model-config
  provider: OpenAI
  model: gpt-4o-mini
  secretRef:
    name: kagent-openai
    key: OPENAI_API_KEY

# Agent configuration
agent:
  name: k2a-enterprise-monitoring
  namespace: kagent
  modelConfig: k2a-model-config
  # Use ConfigMap for systemMessage (scalable option)
  systemMessageConfigMap:
    enabled: true
    create: true
    name: k2a-system-prompt
    key: system-prompt
  systemMessage: |
    You are K2A, an AI agent for Kubernetes enterprise monitoring.

    Available Tools by Category:

    ALERTMANAGER (for alerts, silences, notifications):
    - getAlerts: Get current firing and silenced alerts
    - getAlertGroups: Get alerts organized by routing groups
    - getSilences: List active and expired silences
    - createSilence: Create silence for maintenance
    - deleteSilence: Remove a silence
    - getReceivers: List notification receivers
    - getAlertmanagerStatus: Check AlertManager health

    PROMETHEUS (for metrics and monitoring):
    - query: Execute instant PromQL query
    - queryRange: Execute range query for time series
    - getRules: Get alerting and recording rules
    - getTargets: Get scrape target status
    - getPrometheusStatus: Check Prometheus health

    RED HAT SUPPORT (for KB and cases):
    - searchKnowledgeBase: Search Red Hat KB articles
    - getSolution: Get full KB article content
    - createCase: Create support case
    - getCase: Get case details
    - searchCases: List and filter cases
    - addComment: Add comment to case

    Tool Selection Rules:
    - For ALERTS: Use getAlerts or getAlertGroups
    - For METRICS: Use query or queryRange
    - For RED HAT KB: Use searchKnowledgeBase
    - For SUPPORT CASES: Use searchCases, createCase, getCase

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi

# RemoteMCPServer definitions (conexiones del agente a los MCP servers)
mcpServers:
  prometheus:
    enabled: true
    name: prometheus-mcp-server
    description: "Prometheus MCP server for querying metrics and alerts"
    url: "http://prometheus-mcp.k2a-mcp-servers.svc.cluster.local:9081/mcp"
    tools:
      # Actual tool names from Quarkus MCP server
      - query
      - queryRange
      - getRules
      - getTargets
      - getPrometheusStatus

  alertmanager:
    enabled: true
    name: alertmanager-mcp-server
    description: "AlertManager MCP server for managing alerts and silences"
    url: "http://alertmanager-mcp.k2a-mcp-servers.svc.cluster.local:9082/mcp"
    tools:
      # Actual tool names from Quarkus MCP server
      - getAlerts
      - getAlertGroups
      - getSilences
      - createSilence
      - deleteSilence
      - getReceivers
      - getAlertmanagerStatus

  redhatCases:
    enabled: true
    name: redhat-cases-mcp-server
    description: "Red Hat Cases MCP server for KB search and case management"
    url: "http://redhat-cases-mcp.k2a-mcp-servers.svc.cluster.local:9080/mcp"
    tools:
      # Actual tool names from Quarkus MCP server
      - searchKnowledgeBase
      - getSolution
      - createCase
      - getCase
      - addComment
      - searchCases
      - updateCase
      - getAccountInfo
      - getEntitlements
      - getStatistics
      - listProducts
      - listVersions

  sessionize:
    enabled: false  # Temporarily disabled for testing
    name: sessionize-mcp-server
    description: "Sessionize MCP server for conference and event data"
    url: "http://sessionize-mcp.k2a-mcp-servers.svc.cluster.local:8080/mcp"
    tools:
      - getSpeakers
      - findSpeaker
      - getSessionsBySpeaker
      - getSessions
      - findSession
      - getSchedule

# A2A Skills
a2aSkills:
  - id: alert-monitoring
    name: Alert Monitoring
    description: Monitor and analyze alerts from Prometheus and AlertManager
    examples:
      - What alerts are currently firing?
      - Show me critical alerts
    tags:
      - alerts
      - monitoring
    inputModes:
      - text
    outputModes:
      - text

  - id: metrics-analysis
    name: Metrics Analysis
    description: Query and analyze Prometheus metrics
    examples:
      - What is the CPU usage?
      - Show memory usage
    tags:
      - metrics
      - prometheus
    inputModes:
      - text
    outputModes:
      - text

  - id: redhat-support
    name: Red Hat Support
    description: Search Red Hat KB and manage support cases
    examples:
      - Search for OOMKilled errors
      - Create a support case
    tags:
      - redhat
      - kb
      - support
    inputModes:
      - text
    outputModes:
      - text

  - id: conference-info
    name: Conference Information
    description: Get speakers, sessions and schedule from Sessionize events
    examples:
      - Who are the speakers at the conference?
      - Find sessions about Kubernetes
      - What's the schedule for today?
    tags:
      - conference
      - sessionize
      - speakers
    inputModes:
      - text
    outputModes:
      - text

# =============================================================================
# SECCION 3: CONFIGURACION COMPARTIDA
# =============================================================================

networkPolicy:
  enabled: true

monitoring:
  serviceMonitor:
    enabled: false
  prometheusRule:
    enabled: true

autoscaling:
  enabled: false

podDisruptionBudget:
  enabled: false
